<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
      <meta charset="utf-8" />
      <title>SSAS(SQL Server Analysis Services) access Oracle DB is Shit Solution [安裝篇]</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta name="description" content="" />
      <meta name="author" content="cloudtu" />
      <meta name="keywords" content="" />

      <!-- Le styles -->
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
      <link rel="stylesheet" href="/css/base.css" />
      <link rel="stylesheet" href="/css/prettify.css" />
  </head>
  <body onload="prettyPrint()">

  <!-- facebook script -->
  <div id="fb-root"></div>
  <script xml:space="preserve">
  //<![CDATA[
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v2.4";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  //]]>
  </script>

  <div id="wrap">
    <div>

    <!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" shape="rect" href="/index.html">CloudTu's blog</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" shape="rect">Tags<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li>
                  <a shape="rect" href="/tags/android.html">android</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/aws.html">aws</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/bitbucket.html">bitbucket</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/cassandra.html">cassandra</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/connection-pool.html">connection-pool</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/eclipse.html">eclipse</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/gae.html">gae</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/git.html">git</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/github.html">github</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/guava.html">guava</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/java.html">java</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/javascript.html">javascript</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/jax-rs.html">jax-rs</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/jersey.html">jersey</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/jetty.html">jetty</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/jquery.html">jquery</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/linux.html">linux</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/nexus7.html">nexus7</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/notepad-plus-plus.html">notepad-plus-plus</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/oauth2.html">oauth2</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/olap.html">olap</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/python.html">python</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/remote-control.html">remote-control</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/router.html">router</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/selenium.html">selenium</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/ssh.html">ssh</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/switch.html">switch</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/tomato.html">tomato</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/tomcat.html">tomcat</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/windows7.html">windows7</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/喔~鋼普拉.html">喔~鋼普拉</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/心情記事.html">心情記事</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/敗~敗家啦.html">敗~敗家啦</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/版控系統.html">版控系統</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/程式語言.html">程式語言</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/阿殺不魯.html">阿殺不魯</a>
                </li>
                <li>
                  <a shape="rect" href="/tags/電影、戲劇.html">電影、戲劇</a>
                </li>
              </ul>
            </li>
            <li><a shape="rect" href="/archive.html">Archive</a></li>
            <li><a shape="rect" href="/feed.xml">RSS</a></li>
            <li><a shape="rect" href="/about.html">About</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" shape="rect">Search<b class="caret"></b></a>
              <ul class="dropdown-menu google_search">
                <li>
                  <script xml:space="preserve">
                  //<![CDATA[
                    (function() {
                      var cx = '001738447238955852876:bkori8ynpby';
                      var gcse = document.createElement('script');
                      gcse.type = 'text/javascript';
                      gcse.async = true;
                      gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                          '//cse.google.com/cse.js?cx=' + cx;
                      var s = document.getElementsByTagName('script')[0];
                      s.parentNode.insertBefore(gcse, s);
                    })();
                  //]]>
                  </script>
                  <gcse:searchbox-only></gcse:searchbox-only>
                </li>
              </ul>
            </li>
          </ul>

        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
    <div class="container">

      <div class="page-header">
        <h1>SSAS(SQL Server Analysis Services) access Oracle DB is Shit Solution [安裝篇]</h1>
      </div>

      <p><em>2013-02-08</em></p>

      <p>
        <em>Tags:
          <span>
            <a shape="rect" href="../../../tags/程式語言.html">程式語言</a>
            <span>,</span>
          </span>
          <span>
            <a shape="rect" href="../../../tags/olap.html">olap</a>
            
          </span>
        </em>
      </p>

      <p>
&lt;前言&gt;
<br>
<br>這陣子因為外力因素，接手了「SSAS(SQL Server Analysis Services) access Oracle DB 」的怪異Solution。這東西簡單來說就是用Microsft SQLServer內建的
<a href="http://zh.wikipedia.org/wiki/%E7%B7%9A%E4%B8%8A%E5%88%86%E6%9E%90%E8%99%95%E7%90%86" target="_blank">OLAP</a>功能，但是不拿它來分析MSSQL DB的資料卻拿它來分析Oracle DB的資料。
<br>
<br>在江湖上走唱多年的Software Engineer都很清楚這樣的組合會有不少風險。因為M社產品的特徵向來是跟自家產品整合最OK，如果不幸自家東西串不起來，只要有付維護合約的費用
<strike>
 (保護費)
</strike>，M社大多都會想辦法幫你解決。當然啦，M社產品就是只能.Net平台，想要M社支援Java或其它語言，那可能要等太陽從西邊出來才辦的到囉。至於O社產品呀，它是蠻多跨平台的各類產品跟元件啦，不過每個都要錢，而且很貴
<strike>
 (如果你用了卻少付錢或不付錢偷用，O社強大的律師群會告的你哭爹喊娘)
</strike>。
<br>
<br>二家公司都這麼有個性，卻硬要把二家的產品串在一起用，我直覺就是種玩火的行為。在接手這個怪異的玩意兒後，我只能說這是個「shit solution」或是「big bomb」，如果你剛好正在考慮OLAP Solution，然後又不是全部都走.Net base，最好還是三思而後行呀...=3=
<br>===========================================================================
<br>&lt;安裝環境&gt;
<br>
<br>1.Win7 64bit(或Win 200X Server 64bit)
<br>2.SQL Server 2008 R2 64bit standard version
<br>3.Oracle 10g(或11g) DB 64bit
<br>===========================================================================
<br>&lt;名詞解說&gt;
<br>
<br>SSAS：
<span class="st">SQL Server Analysis Services。簡單來說就是M社在SQLServer內提供的OLAP跟BI功能。</span> 
<br>BIDS：SQL Server Business Intelligence Development Studio。OLAP跟BI的開發工具。
<br>SSMS：SQL Server Management Studio。SQLServer的管理工具。
<br>=========================================================================== 
<br>&lt;安裝流程&gt;
<br>
<br>1.安裝 SQLServer 2008 R2
<br>安裝時建議全部功能都裝，只是我們主要是使用SSAS功能。
<br>
<br>2.安裝 SQLServer 2008 R2 的SP2 patch
<br>更新了一堆有的沒的東西，如果是剛開始裝一個全新的系統，還是乖乖的patch一下
<a href="http://www.microsoft.com/zh-tw/download/details.aspx?id=30437" target="_blank">這個</a>
<a href="http://www.microsoft.com/zh-tw/download/details.aspx?id=30437" target="_blank">SP2(SQLServer2008R2SP2-KB2630458-x64-CHT.exe)</a>吧。裝完後開啟SSMS後可以看到版本號是10.50.4000
<br>
<a href="/img/2013/02/201302082120_1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/img/2013/02/201302082120_1.jpg"></a>
<br>
<br>3.安裝 
<a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-win32soft-098987.html" target="_blank">Oracle Database 11g Release 2 Client (11.2.0.1.0) for Microsoft Windows (32bit)</a>
<br>step1.選擇自訂安裝
<br>
<a href="/img/2013/02/201302082120_2.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="300" src="/img/2013/02/201302082120_2.jpg" width="400"></a>
<br>step2.安裝的位置設在「C:\oracle_32bit\11.2.0\client_1」 
<br>step3.只要安裝紅框選的那三個元件
<br>
<a href="/img/2013/02/201302082120_3.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="332" src="/img/2013/02/201302082120_3.jpg" width="400"></a>
<br>step4.先決條件的判斷會出錯，直接忽略它強制安裝
<br>
<a href="/img/2013/02/201302082120_4.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="332" src="/img/2013/02/201302082120_4.jpg" width="400"></a>
<br>
<br>4.安裝 
<a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-win64soft-094461.html" target="_blank">Oracle Database 11g Release 2 Client (11.2.0.1.0) for Microsoft Windows (x64)</a>
<br>安裝方式跟上一個流程一樣，但是安裝位置要分開，改放在「C:\oracle_64bit\11.2.0\client_1」不可以相同。 
<br>
<br>5.撰寫 tnsnames.ora 設定檔
<br>手工建立「C:\oracle_32bit\11.2.0\client_1\network\admin」目錄與「C:\oracle_64bit\11.2.0\client_1\network\admin」目錄。在這二個目錄中都建立一個「相同」內容的「tnsnames.ora」檔案。該檔的內容長的像下列範例 
<br>
<pre class="prettyprint"><code>TEST_DB =<br>  (DESCRIPTION =<br>    (ADDRESS_LIST =<br>      (ADDRESS = (PROTOCOL = TCP)(HOST = 127.0.1.1)(PORT = 1521))<br>    )<br>    (CONNECT_DATA =<br>      (SID = testdb)<br>      (SERVER = DEDICATED)<br>    )<br>  )<br></code></pre>
<br>6.改環境變數的Path參數
<br>作業系統裡環境變數的Path參數在裝完32bit與64bit的Oracle client後會長的類似下面這樣，把紅色刪除線部份的Path從設定中給移掉。
<br>C:\oracle_64bit\11.2.0\client_1\bin;
<strike>
 <code>C:\oracle_32bit\11.2.0\client_1\bin;</code>
</strike>%JAVA_HOME%\bin;%GRADLE_HOME%\bin;...etc
<br>
<br>7.在SQLServer相關的UserGroup成員清單裡加入administrator使用者
<br>下圖紅框所示的都要改。我直接將我的帳號(這帳號具有本機admin權限)加入SQLServer相關的UserGroup。如果是PRD系統，最好不要這樣做，而是開個SQLServer專用的admin帳號再把它加進去。
<br>
<a href="/img/2013/02/201302082120_5.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="245" src="/img/2013/02/201302082120_5.jpg" width="400"></a>
<br>
<br>8.將Service的啟動者身份改成administrator使用者
<br>下圖紅框所示的都要改。我直接拿我的帳號(這帳號具有本機admin權限)來啟動服務，如果是PRD系統，最好不要這樣做，而是開個SQLServer專用的admin帳號，再用它來啟動服務。
<br>
<a href="/img/2013/02/201302082120_6.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="141" src="/img/2013/02/201302082120_6.jpg" width="400"></a>
<br>
<br>9.撰寫 LaunchBIDS.bat (這步驟非必需，不過建議還是設定一下)
<br>在桌面上寫個LaunchBIDS.bat，以後都用它來啟動BIDS。參考範例如下。
<br>
<pre class="prettyprint"><code>@echo on<br><br>set path=C:\oracle_32bit\11.2.0\client_1\bin;%path%<br>c:<br>cd\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE<br>start devenv.exe<br>exit<br></code></pre>
<br>10.重新開機
<br>
<code>超重要，一定要重開</code>，免的有一些奇怪的靈異現象!
<br>=========================================================================== 
<br>&lt;安裝如此怪異的原因&gt;
<br>
<br>上述安裝說明在M社官方文件是完全不提的(大概也不想提吧，因為O社也有BI的產品在搶市場)，只有forum上有零星的討論。目前看到最切中要害的解說是這篇「
<a href="http://blogs.msdn.com/b/davidlean/archive/2010/10/16/solution-can-edit-but-can-t-process-an-analysis-server-cube-using-oracle-data.aspx" target="_blank">Solution: Can edit, but can’t process, an Analysis Server Cube using ORACLE data</a>」，有興趣的可以看看，該篇的重點解說如下。
<br>
<br>SSAS可以分成二部份，「開發環境」跟「Runtime」。當你啟動BIDS在上面進行開發時，所有的動作都是在BIDS這個開發環境上運作。當開發結束進行deploy後，你的程式就放到SSAS service這個Runtime上運行。也就是說BIDS是開發環境、SSAS service是個Runtime。
<br>
<br>但是SQLServer 2008 R2有個很怪異的地方，那就是
<code>BIDS只有32bit的版本</code>，所以在64bit作業系統上啟動BIDS時，它是以32bit相容模式在執行。BIDS在開發時是直接跟SSAS與OracleDB溝通(下圖粉紅色線條所示)
<br>
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;">
 <tbody>
  <tr>
   <td style="text-align: center;"><a href="/img/2013/02/201302082120_7.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="135" src="/img/2013/02/201302082120_7.png" width="400"></a></td>
  </tr>
  <tr>
   <td class="tr-caption" style="text-align: center;">本圖取自 http://blogs.msdn.com/b/davidlean</td>
  </tr>
 </tbody>
</table>正因為BIDS只有32bit，所以一定要裝32bit版的Oracle Client，這樣你在開發時在設定「資料來源」時，才可以看到下圖所示的Oracle driver。如果沒看到這玩意兒，恭喜你在第一關就卡住了，因為你連資料連線都建不起來了，後續什麼建dimension、cube啦都玩不下去了...XD
<br>
<br>
<a href="/img/2013/02/201302082120_8.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="362" src="/img/2013/02/201302082120_8.jpg" width="400"></a>
<br>
<br>但是累，我們的SSAS service跟OracleDB是64bit的，再外加deploy後是由SSAS跟Oracle進行溝通(下圖淺藍色線條所示)，所以一定要裝64bit版的Oracle Client。
<br>
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;">
 <tbody>
  <tr>
   <td style="text-align: center;"><a href="/img/2013/02/201302082120_9.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="133" src="/img/2013/02/201302082120_9.png" width="400"></a></td>
  </tr>
  <tr>
   <td class="tr-caption" style="text-align: center;">本圖取自 http://blogs.msdn.com/b/davidlean</td>
  </tr>
 </tbody>
</table>如果有成功安裝64bit的Oracle Client，開啟SSMS可以看到下圖紅框所示的Oracle driver。如果沒看到這玩意兒，那包準在每次的deploy永遠都會噴ora開頭的錯誤，Oracle DB永遠也連不上...XD
<br>
<br>
<a href="/img/2013/02/201302082120_10.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/img/2013/02/201302082120_10.jpg"></a>
<br>
<br>那...裝完32bit跟64bit的Oracle Client後就一切天下太平不再發生怪事了嗎?當然沒那麼好，別忘了我們可是同時裝了32bit跟64bit的Oracle Client呀!所以
<code>一定要在環境變數的Path參數中設定64bit Oracle Client的路徑，不然SSAS一旦開始跟Oracle DB抓資料時整個SSAS就整個死當，而且完全不會告訴你原因為何!</code>
<br>
<br>那...設好環境變數的Path參數之後，SSAS總該就不會死當了吧?可惜呀，它還是當給你看!SSAS的服務在執行時，預設是用「Network Service」帳號在執行。這個帳號可是沒有權限直接讀取tnsnames.ora設定檔的呀。當它無法讀到設定檔內容時會怎樣?沒錯!你猜對了，SSAS又整個死當，而且完全不會告訴你原因為何!這也是為何在安裝步驟裡要去設定那些角色權限跟Service權限改用admin帳號的原因...囧rz
<br>
<br>
<a href="/img/2013/02/201302082120_11.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="376" src="/img/2013/02/201302082120_11.jpg" width="400"></a>
<br>===========================================================================
<br>&lt;後記&gt;
<br>
<br>這個混蛋系統，裝完後就可以一路happy的使用嗎?我的答案是No，它在開發上其實有個很重要的地方沒完整實作，會讓維護的人遇到時很頭大。不過這是另個故事了，改天等講到[開發篇]時我再來說吧。這系統光是安裝，就花了我二週多才完全搞定，整個就是讓人覺的悲劇一場呀。
<br>
<br>什麼?你問我最大的心得是什麼?我的心得只有......
<br>
<br>
<div class="separator" style="clear: both; text-align: center;">
 <a href="/img/2013/02/201302082120_12.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/img/2013/02/201302082120_12.jpg"></a>
</div>
<br>
<div class="separator" style="clear: both; text-align: center;">
 <a href="/img/2013/02/201302082120_13.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/img/2013/02/201302082120_13.jpg"></a>
</div>
<br>我是不知道SQL Server 2012裡的SSAS是否有把這些鳥問題都解決了
<strike>
 (M社有這麼佛心來著?)
</strike>，不管怎樣，如果你剛好正打算用M社產品串其它公司的產品，最好先想想或試一試需要的所有功能是不是都正常。免的哪天不小心掉到這種大糞坑時，讓你唉唉叫呀...=3=
</p>

      <hr />

      <!-- facebook like button -->
      <div class="fb-like" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false" data-href="http://cloudtu.github.io/blog/2013/02/ssassql-server-analysis-services-access.html"></div>

      <!-- facebook share button -->
      <div class="fb-share-button" data-layout="button_count" data-href="http://cloudtu.github.io/blog/2013/02/ssassql-server-analysis-services-access.html"></div>

      <!-- Disqus comment plugin -->
      <div id="disqus_thread"></div>
      <script type="text/javascript" xml:space="preserve">
      //<![CDATA[
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//cloudtu.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      //]]>
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow" shape="rect">comments powered by Disqus.</a></noscript>

    </div>
  </div>
  <div>
      <div id="push"></div>

        <div id="footer">
          <div class="container">
            <p class="muted credit">&copy; <span>2015</span> CloudTu | Baked with <a href="http://jbake.org" shape="rect">JBake
              <span>v2.3.2</span></a></p>
          </div>
        </div>

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script xml:space="preserve" src="/js/jquery-2.1.1.min.js"></script>
        <script xml:space="preserve" src="/js/bootstrap.min.js"></script>
        <script xml:space="preserve" src="/js/prettify.js"></script>

      </div>
    </body>
</html>
